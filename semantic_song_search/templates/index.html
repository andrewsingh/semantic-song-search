<!DOCTYPE html>
<html lang="en" data-debug-mode="{% if debug_mode %}true{% else %}false{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic Song Search</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    
    <!-- Mixpanel -->
    <script type="text/javascript">
    (function(c,a){if(!a.__SV){var b=window;try{var d,m,j,k=b.location,f=k.hash;d=function(a,b){return(m=a.match(RegExp(b+"=([^&]*)")))?m[1]:null};f&&d(f,"state")&&(j=JSON.parse(decodeURIComponent(d(f,"state"))),"mpeditor"===j.action&&(b.sessionStorage.setItem("_mpcehash",f),history.replaceState(j.desiredHash||"",c.title,k.pathname+k.search)))}catch(n){}var l,h;window.mixpanel=a;a._i=[];a.init=function(b,d,g){function c(b,i){var a=i.split(".");2==a.length&&(b=b[a[0]],i=a[1]);b[i]=function(){b.push([i].concat(Array.prototype.slice.call(arguments,0)))}}var e=a;"undefined"!==typeof g?e=a[g]=[]:g="mixpanel";e.people=e.people||[];e.toString=function(b){var a="mixpanel";"mixpanel"!==g&&(a+="."+g);b||(a+=" (stub)");return a};e.people.toString=function(){return e.toString(1)+".people (stub)"};l="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");for(h=0;h<l.length;h++)c(e,l[h]);a._i.push([b,d,g])};a.__SV=1.6;l=c.createElement("script");l.type="text/javascript";l.async=!0;l.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===c.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";h=c.getElementsByTagName("script")[0];h.parentNode.insertBefore(l,h)}})(document,window.mixpanel||[]);

    // Initialize Mixpanel with debug mode from data attribute
    var debugMode = document.documentElement.getAttribute('data-debug-mode') === 'true';
    mixpanel.init("7d28460e85f4c7776c1f29d298782de0", {
        debug: debugMode,
        track_pageview: true,
        persistence: 'localStorage'
    });
    </script>
</head>
<body>
    <div class="app-container" data-debug-mode="{% if debug_mode %}true{% else %}false{% endif %}">
        <!-- Header with Search Bar and Controls -->
        <header class="search-header">
            <div class="header-content">
                <h1 class="app-title">Semantic Song Search</h1>
                
                <!-- Search Configuration Row -->
                <div class="search-config">
                    <div class="segmented-control" id="search-type-control" role="radiogroup" aria-label="Search mode selection">
                        <input type="radio" id="search-type-text" name="search-type" value="text" checked>
                        <label for="search-type-text" class="segment-label">
                            <span class="segment-icon" aria-hidden="true">üìù</span>
                            <span class="segment-text">Text-to-Song</span>
                        </label>
                        <input type="radio" id="search-type-song" name="search-type" value="song">
                        <label for="search-type-song" class="segment-label">
                            <span class="segment-icon" aria-hidden="true">üéµ</span>
                            <span class="segment-text">Song-to-Song</span>
                        </label>
                    </div>
                    
                    <select id="embed-type" class="config-dropdown">
                        <option value="tags_genres">Tags & Genres</option>
                        <option value="sound_aspect">Sound</option>
                        <option value="meaning_aspect">Meaning</option>
                        <option value="mood_aspect">Mood</option>
                        <option value="full_profile">Full Profile</option>
                    </select>
                    
                </div>
                
                <!-- Search Bar -->
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" 
                           placeholder="üîç Describe the vibe you're looking for... (e.g., &quot;upbeat summery pop&quot;, &quot;motivational workout hip hop&quot;)">
                </div>
                
                <!-- Suggestions Dropdown (for song-to-song search) -->
                <div id="suggestions" class="suggestions-container" style="display: none;"></div>
                
                <!-- Auth Status -->
                <div class="auth-status">
                    <span id="auth-indicator" class="auth-indicator">‚óã</span>
                    <span id="auth-text">Not connected to Spotify</span>
                    <button id="login-btn" class="login-btn" style="display: none;">Login to Spotify</button>
                    <button id="logout-btn" class="logout-btn" style="display: none;">Logout</button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Query Song Card (only for song-to-song search) -->
            <section id="query-section" class="query-section" style="display: none;">
                <h2 class="section-title">üéØ Query Song</h2>
                <div id="query-card" class="song-card query-card"></div>
            </section>
            
            <!-- Export to Playlist Accordion -->
            <section id="export-section" class="export-section" style="display: none;">
                <div class="export-accordion">
                    <button class="export-accordion-header" id="export-accordion-btn">
                        <span class="export-accordion-title">üìã Export Results to Playlist</span>
                        <span class="export-accordion-icon">‚ñº</span>
                    </button>
                    <div class="export-accordion-content" id="export-accordion-content">
                        <div class="export-form">
                            <div class="export-field">
                                <label for="playlist-name" class="export-label">Playlist Name:</label>
                                <input type="text" id="playlist-name" class="export-input" 
                                       placeholder="My Semantic Search Playlist">
                            </div>
                            <div id="song-count-field" class="export-field">
                                <label for="song-count" class="export-label">Number of Songs:</label>
                                <input type="number" id="song-count" class="export-input" 
                                       min="1" max="100" value="10">
                            </div>
                            <div id="manual-selection-info" class="export-field" style="display: none;">
                                <span class="export-label">Selected Songs:</span>
                                <span id="selected-songs-count" class="export-info-text">0 songs selected</span>
                            </div>
                            <button id="export-btn" class="export-button">
                                <span class="export-button-text">Create Playlist</span>
                                <span class="export-button-loading" style="display: none;">Creating...</span>
                            </button>
                        </div>
                        <div id="export-status" class="export-status" style="display: none;"></div>
                    </div>
                </div>
            </section>
            
            <!-- Search Results -->
            <section id="results-section" class="results-section">
                <div id="results-header" class="results-header" style="display: none;">
                    <div class="results-controls">
                        <div class="results-left">
                            <h2 class="section-title">Similar Songs</h2>
                            <div class="results-filters">
                                <div class="filter-option">
                                    <label class="filter-checkbox-label">
                                        <input type="checkbox" id="manual-selection-toggle" class="filter-checkbox">
                                        <span class="filter-text">Manual Selection</span>
                                    </label>
                                </div>
                                <div class="filter-option">
                                    <label class="filter-checkbox-label">
                                        <input type="checkbox" id="top-artists-filter" class="filter-checkbox" disabled>
                                        <span id="top-artists-text" class="filter-text">Only My Top Artists</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="results-info">
                            <span id="results-count"></span>
                            <span id="search-info"></span>
                            <div class="results-spotify-attribution">
                                <a href="https://open.spotify.com" target="_blank" rel="noopener noreferrer" class="results-spotify-logo-link">
                                    <img src="{{ url_for('static', filename='assets/2024-spotify-full-logo/Full_Logo_Green_RGB.svg') }}" 
                                         alt="Spotify" class="results-spotify-logo">
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="results-container" class="results-container">
                    <!-- Welcome message -->
                    <div id="welcome-message" class="welcome-message">
                        <div class="welcome-content">
                            <h3>Welcome to Semantic Song Search!</h3>
                            <p>How to use this app:</p>
                            
                            <h4>üîç Make a search query</h4>
                            <ul>
                                <li><strong>Text-to-Song:</strong> Search songs by describing the vibe you're looking for (e.g., "upbeat summery pop", "motivational workout hip hop")</li>
                                <li><strong>Song-to-Song:</strong> Find songs that are similar to one that you have in mind</li>
                                <li><strong>Search aspects:</strong> Looking for different results? Try changing the search aspect in the dropdown menu above the search bar. The default aspect is "Tags & Genres".</li>
                            </ul>
                            
                            <h4>üéõÔ∏è View and filter results</h4>
                            <ul>
                                <li><strong>Playable songs:</strong> Click on any song card to play the song in the built-in web player</li>
                                <li><strong>Search filters:</strong> Refine your search results by adding one or more filters</li>
                                <li><strong>Manual selection:</strong> Enable this mode to select specific songs to include in your playlist</li>
                            </ul>
                            
                            <h4>üöÄ Export to playlist</h4>
                            <ul>
                                <li>Once you're happy with your results, click <strong>Export Results to Playlist</strong></li>
                                <li>Change the playlist name and number of songs if you'd like, then click <strong>Create Playlist</strong></li>
                                <li>That's it! Your new playlist will now appear in your Spotify library. Happy listening!</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Results will be populated here -->
                    <div id="results-grid" class="results-grid"></div>
                    
                    <!-- Load More Button -->
                    <div id="load-more-container" class="load-more-container" style="display: none;">
                        <button id="load-more-btn" class="load-more-btn">Load More Results</button>
                    </div>
                </div>
                
                <!-- Loading indicator -->
                <div id="loading" class="loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Searching for similar songs...</p>
                </div>
            </section>
        </main>

        <!-- Spotify Web Player (Fixed at Bottom) -->
        <footer class="player-footer">
            <div id="spotify-player" class="spotify-player">
                <!-- Spotify Attribution -->
                <div class="spotify-attribution">
                    <a href="https://open.spotify.com" target="_blank" rel="noopener noreferrer" class="spotify-logo-link">
                        <img src="{{ url_for('static', filename='assets/2024-spotify-full-logo/Full_Logo_Green_RGB.svg') }}" 
                             alt="Spotify" class="spotify-logo">
                    </a>
                </div>
                <!-- Player will be initialized here -->
                <div class="player-content">
                    <div class="track-info">
                        <img id="player-cover" class="player-cover" src="" alt="Album Cover">
                        <div class="track-details">
                            <div id="player-title" class="player-title">No track selected</div>
                            <div id="player-artist" class="player-artist">Connect to Spotify to play music</div>
                        </div>
                    </div>
                    
                    <div class="player-controls">
                        <button id="prev-btn" class="control-btn">‚èÆ</button>
                        <button id="play-btn" class="control-btn play-btn">‚ñ∂</button>
                        <button id="next-btn" class="control-btn">‚è≠</button>
                    </div>
                    
                    <div class="progress-container">
                        <span id="current-time" class="time-label">0:00</span>
                        <div class="progress-bar-container">
                            <div id="progress-bar" class="progress-bar">
                                <div id="progress-filled" class="progress-filled"></div>
                            </div>
                        </div>
                        <span id="total-time" class="time-label">0:00</span>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html> 